## TASK 14
* * *

### Choosing dataset
* For that task was chosen the maximum uncomfortable csv dataset from Kaggle.com with a huge text fields
* Dataset consider inside Steam games reviews from gamers 
* Dataset size 10 Gb with, 40M rows, bun into DB were only uploaded 11M
* For csv read and upload dataset was used ```dask``` lib from python with partition mechanical inside 

```mysql
SELECT FORMAT(COUNT(app_name), '# #') AS rows_count
FROM steam_reviews;
```

| rows\_count |
|:------------|
| 11,134,871  |

- - -

### 1. SELECT without any index

* Try ```SELECT``` with ```FULLTEXT``` by one column and simple condition ```WHERE your_field SOUNDS LIKE 'searching_text'```

```mysql
EXPLAIN
SELECT app_name, review
FROM steam_reviews
WHERE review SOUNDS LIKE 'bad not good';

-- execution: 21 s 858 ms, fetching: 10 ms
```

| app\_name        | review         |
|:-----------------|:---------------|
| Portal 2         | perfect buy it |
| Wallpaper Engine | PERFECT BUY IT |
| Among Us         | Perfect buy it |

| id   | select\_type | table          | partitions | type  | possible\_keys | key   | key\_len | ref   | rows     | filtered | Extra       |
|:-----|:-------------|:---------------|:-----------|:------|:---------------|:------|:---------|:------|:---------|:---------|:------------|
| 1    | SIMPLE       | steam\_reviews | null       | ALL   | null           | null  | null     | null  | 10746428 | 100      | Using where |

* find only 3 rows

* * *

### 2. Using ```FULLTEXT``` INDEX:

* create ```FULLTEXT``` index:

```mysql
CREATE FULLTEXT INDEX fulltxt_indx ON steam_reviews (review);

-- completed in 7 m 34 s 226 ms
```

* do selection on a full text searching

```mysql
SELECT app_name, review
FROM steam_reviews
WHERE MATCH (review) AGAINST ('perfect video');

-- execution: 192 ms, fetching: 61 ms
```

| app\_name                      | review                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|:-------------------------------|:----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Stardew Valley                 | " life is not perfect, but I still love life. ”<br/>- - - - - - - - - - - - - - - - - - - - - - -<br/>Star valley is a ranch language game, similar to the GBA version of ore town style and PSP version of honey village plot fusion.<br/>But generally this kind of game will give the story set a perfect, fairy tale story background, and star valley is not.<br/>When you have a good relationship with them, you can enter their rooms to view items and unlock specific scenarios to tell the story behind them.<br/>There are veterans returned from the war, life is deeply wounded by the war, and years not see son has become strangers; There are reorganization of the family cracks, wife and ex-husband son of family change is not acceptable; Irresponsible men because they don't like the bound life left his wife and daughter, leaving a broken family; Have originally polite, gentle and elegant young man, after suffering from accidental paralysis and bereavement, became a grumpy old man. . . And a variety of intricate relationships. Almost every family has its own unspeakable story.<br/>This is not the perfect village in fairy tales, but life is so. Just like when we were young, we always came into contact with the good side of things; When we get more mature and know the other side of things, some of us become cynics. They always fantasize about taoyuan township; But who knows taoyuan township people may also have their own one or two secret?<br/>Every thing has its own two sides, like light and shadow alternate twins. Recognizing and accepting the other side of the shadow is also the process of our growth. Father returned from the war, very hard to accompany the child training, want to make up for their own past, become a better father; After dad tried to be a good stepfather, although always failed, but always did not give up efforts; The girl finally said to his unrequited love boy for many years; Failed marriage, alcoholic mother found a new job and started again; He looked at his past, began to change his grumpy temper and negative attitude towards life bit by bit ...<br/>Maybe this is the star valley want to tell us. Life is always bad, but the decision to choose a way of life is still in our hands. Even though the food planted may be flooded, sun - dried, withered and poor harvest, was taken away by the crow, today I still want to sow this seed, hope she sprout growth, produce fruitful results. Life is not perfect, but I still love life.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |

| id   | select\_type | table          | partitions | type     | possible\_keys | key           | key\_len | ref   | rows  | filtered | Extra                          |
|:-----|:-------------|:---------------|:-----------|:---------|:---------------|:--------------|:---------|:------|:------|:---------|:-------------------------------|
| 1    | SIMPLE       | steam\_reviews | null       | fulltext | fulltxt\_indx  | fulltxt\_indx | 0        | const | 1     | 100      | Using where; Ft\_hints: sorted |

#### Try searching modes ```IN NATURAL LANGUAGE MODE``` and  ```WITH QUERY EXPANSION```

* ```IN NATURAL LANGUAGE MODE``` 

```mysql
EXPLAIN
SELECT app_name, review
FROM steam_reviews
WHERE MATCH (review) AGAINST ('perfect video' IN NATURAL LANGUAGE MODE);

-- execution: 186 ms, fetching: 47 ms
```

| app\_name      | review                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|:---------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Stardew Valley | " life is not perfect, but I still love life. ”<br/>- - - - - - - - - - - - - - - - - - - - - - -<br/>Star valley is a ranch language game, similar to the GBA version of ore town style and PSP version of honey village plot fusion.<br/>But generally this kind of game will give the story set a perfect, fairy tale story background, and star valley is not.<br/>When you have a good relationship with them, you can enter their rooms to view items and unlock specific scenarios to tell the story behind them.<br/>There are veterans returned from the war, life is deeply wounded by the war, and years not see son has become strangers; There are reorganization of the family cracks, wife and ex-husband son of family change is not acceptable; Irresponsible men because they don't like the bound life left his wife and daughter, leaving a broken family; Have originally polite, gentle and elegant young man, after suffering from accidental paralysis and bereavement, became a grumpy old man. . . And a variety of intricate relationships. Almost every family has its own unspeakable story.<br/>This is not the perfect village in fairy tales, but life is so. Just like when we were young, we always came into contact with the good side of things; When we get more mature and know the other side of things, some of us become cynics. They always fantasize about taoyuan township; But who knows taoyuan township people may also have their own one or two secret?<br/>Every thing has its own two sides, like light and shadow alternate twins. Recognizing and accepting the other side of the shadow is also the process of our growth. Father returned from the war, very hard to accompany the child training, want to make up for their own past, become a better father; After dad tried to be a good stepfather, although always failed, but always did not give up efforts; The girl finally said to his unrequited love boy for many years; Failed marriage, alcoholic mother found a new job and started again; He looked at his past, began to change his grumpy temper and negative attitude towards life bit by bit ...<br/>Maybe this is the star valley want to tell us. Life is always bad, but the decision to choose a way of life is still in our hands. Even though the food planted may be flooded, sun - dried, withered and poor harvest, was taken away by the crow, today I still want to sow this seed, hope she sprout growth, produce fruitful results. Life is not perfect, but I still love life. |

| id   | select\_type   | table          | partitions   | type     | possible\_keys  | key           | key\_len   | ref   | rows  | filtered  | Extra                          |
|:-----|:---------------|:---------------|:-------------|:---------|:----------------|:--------------|:-----------|:------|:------|:----------|:-------------------------------|
| 1    | SIMPLE         | steam\_reviews | null         | fulltext | fulltxt\_indx   | fulltxt\_indx | 0          | const | 1     | 100       | Using where; Ft\_hints: sorted |


* ```WITH QUERY EXPANSION```

```mysql
-- using CTE as a try to cut the selection, but it does not save the server for crushing
WITH cte as (SELECT app_name, review
             FROM steam_reviews
             WHERE MATCH(app_name) AGAINST('+Stardew +Valley' IN NATURAL LANGUAGE MODE))
SELECT app_name,
       review
FROM cte
WHERE MATCH(review) AGAINST('+beautiful +graphics +fun +creative' WITH QUERY EXPANSION);

-- 2023-04-16 22:11:26] Communications link failure
-- [2023-04-16 22:11:26] The last packet successfully received from the server was 56 256 milliseconds ago. The last packet sent successfully to the server was 56 256 milliseconds ago.
```

* these query with ```WITH QUERY EXPANSION``` crashing the server, because there are too many keywords and their variations and any variables as a result
* so, this variant not for big text and huge rows count
* the only way I can see here is a vertical scaling (up the memory on a server config)
